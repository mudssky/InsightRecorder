# 工程初始化与基线（M0）

## 范围

- Electron 39 + electron-vite 4 工程可运行；启用 `contextIsolation`、`sandbox`。
- 统一脚本：`pnpm qa`、`build`、`start` 可用；ESLint/Prettier 规则生效。

## 执行步骤

- 校验并完善 `package.json` 脚本与依赖；确保 pnpm 锁文件一致。
- 主/渲染分离与 `preload` 仅白名单暴露；禁用 `remote`；IPC Schema 校验。
- 接入 `electron-log` 日志记录。
- 测试配置（Vitest）：配置文件集中到 `tests/` 目录
  - 新增脚本：`pnpm run test`（`vitest --run --config tests/vitest.config.ts`）、`pnpm run test:watch`（`vitest --config tests/vitest.config.ts`）
  - 配置文件：`tests/vitest.config.ts`（`environment: 'node'`，为渲染端测试可选 `jsdom` 子配置；别名与 TS 路径对齐）
  - 启动文件：`tests/setup.ts`（全局初始化/模拟、环境变量与 polyfill）
  - 类型声明：`tests/globals.d.ts`（全局测试类型与扩展）
  - TS 配置：`tsconfig.test.json`（继承主配置，排除打包产物，包含 `tests/**/*`）
  - 目录约定：测试用例统一放置 `tests/unit/**`、`tests/e2e/**`，按模块分层

## 验收标准

- 运行 `pnpm qa` 0 error；`pnpm run build` 成功；`pnpm run start` 可启动。
- 安全配置生效，渲染端无法直接访问 Node API。
- 运行 `pnpm run test` 显示 0 failed；所有 Vitest 相关配置文件位于 `tests/`，脚本可正确识别与执行。

## 风险与缓解

- Windows 环境差异：全部脚本走 `pnpm` 与 cross-platform 配置；日志排查。
- Electron/渲染测试环境差异：默认使用 `environment: 'node'`；需要 DOM 的测试使用 `jsdom`；对 Electron API 采用 `preload` 层模拟与 IPC stub；避免直接访问主进程。

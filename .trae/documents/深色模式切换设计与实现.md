## 目标
- 提供三种模式：`light`、`dark`、`system`
- 统一驱动 Ant Design 主题算法与 Tailwind 暗色类（`.dark`）
- 支持跟随系统（Electron `nativeTheme`），并持久化用户选择

## 技术方案
- 全局单一来源：在渲染层维护 `themeMode: 'light'|'dark'|'system'` 与 `isDark: boolean`
- Ant Design：通过 `ConfigProvider` 切换 `algorithm: theme.defaultAlgorithm`/`theme.darkAlgorithm`
- Tailwind：采用 `.dark` 类策略；在运行时对 `document.documentElement.classList` 添加/移除 `dark`
- 系统跟随：通过 preload 暴露 `getSystemTheme()` 与 `onSystemThemeUpdated()`，读取/订阅 `nativeTheme`
- 持久化：
  - 方案A（推荐）：`electron-store` 于主进程持久化，preload 提供读写桥
  - 方案B（MVP）：渲染层使用 `localStorage` 持久化

## 渲染层实现
1. 新增全局主题状态（Zustand 或轻量自定义 store）
   - `themeMode`：`'light'|'dark'|'system'`
   - `isDark`：根据 `themeMode` 与系统暗色计算布尔值
   - 方法：`setThemeMode(mode)`、`initFromStorage()`、`applyDomClass()`
2. `src/renderer/src/main.tsx`
   - 将 `ConfigProvider` 的 `theme.algorithm` 改为依赖 `isDark` 动态选择
   - 在初始化时调用 `initFromStorage()`；若为 `system`，从 `window.api.getSystemTheme()` 取值并订阅
3. `.dark` 类控制
   - 在 `setThemeMode` 与系统事件回调里统一调用 `applyDomClass()`，对 `document.documentElement` 切换 `dark`

## 系统主题桥接（preload/main）
1. `src/preload/index.ts`
   - 暴露：
     - `getSystemTheme(): 'dark'|'light'`
     - `onSystemThemeUpdated(handler: (mode: 'dark'|'light') => void)`
   - 可选：`setThemeSource('system'|'dark'|'light')`（主进程执行）
2. `src/preload/index.d.ts`
   - 为 `window.api` 新增类型定义，避免 `any`
3. `src/main/index.ts`
   - 如采用 IPC：注册 `ipcMain` 处理查询/设置；使用 `nativeTheme.shouldUseDarkColors` 与 `nativeTheme.themeSource`

## 持久化策略
- 方案A（优先）：在主进程使用 `electron-store` 保存 `themeMode`，preload 暴露 `getUserThemeMode()`/`setUserThemeMode()`
- 方案B（MVP）：渲染层用 `localStorage('themeMode')`；在应用启动时读取并应用

## UI 入口
- 在设置页面或顶栏新增切换控件：
  - 控件：`Segmented`（`['系统', '浅色', '深色']`）或 `Switch`
  - 交互：更新全局 `themeMode`，触发 `ConfigProvider` 与 `.dark` 切换，并持久化
- 清理现有硬编码：
  - `src/renderer/src/routes/Root.tsx` 的 `Menu theme="dark"` 改为根据 `isDark` 动态
  - 减少 `bg-white`/`text-black` 等硬编码；使用 antd 默认风格或 `dark:` 变体

## 代码改动点
- `src/renderer/src/main.tsx`：动态 `ConfigProvider.theme.algorithm`
- `src/renderer/src/routes/Root.tsx`：移除 `theme="dark"` 写死，使用全局状态
- `src/renderer/src/routes/Library.tsx`：替换硬编码颜色为可切换样式
- `src/renderer/src/styles/tailwind.css`：保持不变；在组件中使用 `dark:` 变体
- `src/preload/index.ts` 与 `src/preload/index.d.ts`：新增系统主题 API 与类型
- `src/main/index.ts`：如采用 IPC，接入 `nativeTheme`

## 验证与交付
- 运行：`pnpm qa`（`typecheck`/`lint`/`format`）→ `pnpm run build` → `pnpm run start`
- 冒烟测试：
  - 切换 UI 模式三种状态是否生效
  - 在系统主题切换时（Windows 11）`system` 模式是否联动更新
  - 持久化是否正确（重启后仍保留）
- 文档：在 `docs/初始需求文档.md` 增加“实现进展/注意事项”小节记录方案与日期
## 改动目标
- 去掉设备列表页顶部多余按钮，仅保留必要的刷新
- 移除“选中设备”交互与相关状态
- 显示设备“连接状态”（已连接/未连接），并将未连接设备置于列表尾部
- 提供筛选功能：是否显示未连接设备、按设备类型筛选、关键词搜索

## 数据与状态判定
- 已连接设备：以 `device:list` 的枚举结果为准（渲染端 `window.api.listDevices()`）
- 未连接设备：从数据库持久化设备列表中排除“当前枚举结果”得到（需要新增 IPC 读取 DB 中全部设备）
- 变更事件：沿用 `device:changed` 事件刷新（`src/preload/devices.ts:21`）

## IPC/DB 扩展
- 在现有 `src/main/ipc/deviceList.ts` 中新增一个只读 IPC：`devices:persisted:list`
  - 查询 `devices` 表，返回所有设备的 `id/label/mountpoint/lastSeenAt/...`
  - 类型沿用 `DeviceRow`，仅暴露前端所需字段
- 数据库层在 `src/main/db/devices.ts` 增加方法：`listDevices(): DeviceRow[]`
  - SQL：`SELECT id, label, mountpoint, type, autoSync, deleteSourceAfterSync, createdAt, updatedAt, lastSeenAt FROM devices ORDER BY updatedAt DESC`

## 预加载扩展
- `src/preload/devices.ts` 添加：`listPersistedDevices(): Promise<Device[]>`
  - 调用 `ipcRenderer.invoke('devices:persisted:list')`
- `src/preload/index.d.ts` 同步新增类型声明

## Devices.tsx 改造
- 移除选中相关逻辑
  - 删除 `selected` 状态及卡片点击切换（参考 `src/renderer/src/routes/Devices.tsx:159-165`）
  - 删除“导出选中/取消导出”按钮（参考 `Devices.tsx:141-146`）
  - 删除导出进度模态框（参考 `Devices.tsx:195-207`）
- 新增状态
  - `connectedIds: Set<string>`：来自 `listDevices()`
  - `persisted: DeviceInfo[]`：来自 `listPersistedDevices()`
  - `filters`: `showDisconnected: boolean`、`type?: 'recorder'|'generic'|'ignored'|undefined`、`q: string`
- 刷新逻辑
  - 并行拉取：`connected = window.api.listDevices()` 与 `persisted = window.api.listPersistedDevices()`
  - `statsMap`：对 `persisted` 全量设备调用 `getDeviceStats(id)`（未连接设备也可查询 DB 统计）
  - 构造 `displayDevices = persisted.map(d => ({...d, connected: connectedIds.has(d.id)}))`
  - 过滤与排序：
    - 过滤：`type`、`q`（匹配 `label/mountpoint/id`）
    - 根据 `filters.showDisconnected` 决定是否保留未连接项
    - 排序：先 `connected === true`，再 `connected === false`
- UI 渲染
  - 顶部保留：`刷新`、新增筛选区：
    - `Switch`：是否显示未连接设备
    - `Select`：设备类型筛选（`recorder/generic/ignored`）
    - `Input`：关键词搜索
  - 卡片展示：
    - 标题保持 `label || '可移动设备'`
    - 追加 `连接状态：已连接/未连接`
    - 仍保留“详情”按钮（参考 `Devices.tsx:171-179`）
    - 容量进度（保留，但未连接设备可能缺失容量；正常显示 0%）
- 插入设备交互
  - 监听 `onDeviceChanged` 保持不变（`Devices.tsx:82-110`）
  - 仅对“当前已连接集合”执行自动同步/首次配置弹窗逻辑，避免对历史设备误触发

## DeviceDetail.tsx
- 无需改动；保留“保存设置/立即同步”等功能（文件 `src/renderer/src/routes/DeviceDetail.tsx`）

## 验证
- 运行一次 `pnpm qa` 保证类型/Lint/格式化通过
- `pnpm build` 后 `pnpm start` 冒烟：
  - 顶部仅保留刷新与筛选区
  - 连接状态正确显示；拔插后列表刷新、未连接设备位于尾部
  - 筛选：
    - 关闭“显示未连接”后仅展示在线设备
    - 类型筛选与搜索生效
  - 详情页可正常打开，统计显示无误

## 兼容性与注意事项
- 所有新增 IPC 保持只读，遵循 `contextIsolation` 安全基线
- DB 查询采用同步 `better-sqlite3`，注意主进程中执行避免阻塞（结果集较小）
- 过滤与排序在渲染层进行，避免频繁 IPC
- 若将来需要分页或更多统计，可扩展 `devices:list` 响应结构或新增专用 IPC

## 交付口径
- 改动涵盖：主进程 IPC + 预加载类型与方法 + Devices 页面 UI/逻辑
- 不改动：导出流程实现、DeviceDetail、现有自动同步触发逻辑
- 接受标准：页面通过 QA/构建，筛选与状态展现符合预期
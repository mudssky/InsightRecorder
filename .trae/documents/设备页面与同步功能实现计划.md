## 页面与路由

* 新增设备详情路由 `#/devices/:id` 与组件 `DeviceDetail`

* `Devices` 列表卡片点击跳转详情（移除多选与批量导出）

* 顶栏菜单保持不变；在详情页提供“返回设备列表”

## 数据模型与存储

* 新增 `ElectronStore('device-settings')` 以设备 ID 作为键存储：

  * `type: 'recorder' | 'generic' | 'ignored'`

  * `autoSync: boolean`、`deleteSourceAfterSync: boolean`

  * `syncRootDir: string`（全局默认 `exportTargetPath`，设备可覆盖）

  * `folderNameRule: 'label-id' | 'id-date' | 'custom'` 与 `folderTemplate: string`

  * `extensions?: string[]`（覆盖全局），`minSize?: number`、`maxSize?: number`

* 规则：设备设置优先级 > 全局 `app-settings`；未配置时回落到默认值

## 预加载与类型安全

* 在 `preload/index.d.ts` 补充类型并暴露新 API：

  * `getDeviceSettings(id)` / `updateDeviceSettings(id, partial)`

  * `getDeviceStats(id)`（返回 `fileCount`、`syncedCount`、`lastSyncAt` 等）

  * 统一 `startExport({ deviceIds })` 使用设备级配置

* 参数与返回值均定义 TypeScript 接口，IPC 层做 schema 校验

## 主进程 IPC 与同步逻辑

* `device-settings:get` / `device-settings:update`：读写设备级设置

* `device:stats`：按当前设备配置计算并返回统计：

  * 扫描 `mountpoint` 下匹配扩展名与大小的文件计数

  * 从 `export-index` 聚合该设备已同步数

* `collectAudioFiles` 更新为：按设备配置过滤扩展名与大小范围；重复判定沿用指纹（`deviceId|path|size|mtimeMs`），如启用“内容哈希”可增设 SHA256（可选）

* `buildTargetPath`：按设备 `syncRootDir` 与 `folderNameRule/template` 构建目标目录：

  * 默认选项：`{label}-{id}`、`{id}/{date}`、`{label}/{date}`

  * 模板支持占位：`{deviceLabel}`、`{deviceId}`、`{date:YYYYMMDD}`、`{time:HHmmss}`、`{counter}`、`{title}`

* 进度事件中增加设备维度统计并写入 `export-history`

* 若 `deleteSourceAfterSync` 为真，复制成功后安全删除源文件（失败回滚并记录）

## 渲染层 UI

* `Devices.tsx`：

  * 卡片展示：设备名、容量/已用、`fileCount`、`syncedCount`、最近同步时间

  * 右上角“详情”按钮或整卡可点击进入详情

* `DeviceDetail.tsx`：

  * 展示设备 UID、挂载点、容量信息

  * 表单项：设备类型（录音笔/通用/忽略）、自动同步、同步后删除源文件

  * 选择同步根目录（FolderPicker），实时预览目标文件夹名

  * 文件类型多选（`wav/mp3/m4a/...`）、大小区间（MB）

  * 模板字符串输入与预设下拉；预览示例路径

  * 操作区：保存设置、立即同步、查看历史

## 设备插入交互

* 监听 `device:changed` 的 `added`：

  * 若设备未配置或 `autoSync` 未启用 → 弹窗引导配置

  * 若 `autoSync` 启用 → 按设备配置直接调用 `startExport([id])`，不打扰用户

  * 提供全局选项：默认勾选“以后自动同步不再提示”

## 风险与注意事项

* UID 稳定性：仅用盘符可能变化 → 尝试使用 `drivelist` 的 `serialNumber/devicePath/description` 组合生成更稳定的 `uid`，盘符作为回退

* 模板安全：清理非法字符与保留字，限制生成路径深度；Windows 路径兼容（长路径、保留名）

* 并发与取消：遵守 `concurrency`，确保取消可中断并更新历史；错误分级与重试遵循 `retryCount`

## 验证与交付

* 类型检查、Lint、格式化：`pnpm qa`

* 构建与冒烟：`pnpm build` → `pnpm start`，验证列表与详情、插入弹窗、同步流程

* 若测试暂缺：记录 TODO（补充 Vitest 最小用例：设备设置存取、模板生成、文件过滤）

## 迭代建议（可选增强）

* 重复检测增强：跨设备的内容哈希去重（可开关）

* 历史与日志：按设备筛选导出任务历史与失败重试

* 冲突策略：同名文件覆盖/重命名计数器策略

* 模板占位扩展：`{year}/{month}/{day}`、`{artist}` 等从元数据解析


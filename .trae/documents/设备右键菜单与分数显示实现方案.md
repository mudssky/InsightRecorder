## 功能概述

- 为设备卡片添加右键菜单（在资源管理器打开、开始同步、复制设备ID、查看详情、刷新、快速设置设备类型/自动同步）。
- 连接设备后实时更新文件数与容量显示，并以分数形式展现：
  - 文件数显示为 `已同步/总文件`，悬浮提示说明含义。
  - 容量显示为 `已用/总容量`，配合进度条与悬浮提示。

## 代码改动范围

- 渲染层：`src/renderer/src/routes/Devices.tsx`
- 预加载：`src/preload/index.d.ts`、`src/preload/index.ts`、新增 `src/preload/system.ts`
- 主进程：新增 `src/main/ipc/system.ts`（或 `shell.ts`），并在 `src/main/index.ts` 注册。

## 详细实现步骤

### 1) 新增“打开文件夹”能力

- 主进程新增 IPC `system:open-path`：
  - 使用 `electron.shell.openPath(path)` 打开路径；
  - 先校验路径存在且为目录（`fs.promises.stat`）；
  - 仅允许如 `^[A-Z]:\\`（盘符根路径）或设备挂载点（来源于 `device:list`）。
- 预加载新增 `openPath(path: string): Promise<boolean>` 封装 `ipcRenderer.invoke('system:open-path', path)`；
- 在 `src/preload/index.ts` 合并暴露到 `window.api`；同步更新 `index.d.ts` 类型。

### 2) 设备卡片右键菜单（Devices.tsx）

- 引入 `Dropdown` + `Menu`（AntD），在每个 `Card` 外包裹 `Dropdown`，`trigger={['contextMenu']}`。
- 菜单项：
  - `在资源管理器打开` → 调用 `window.api.openPath(d.mountpoint)`；
  - `开始同步` → `window.api.startExport({ deviceIds: [d.id] })`；
  - `复制设备ID` → `navigator.clipboard.writeText(d.id)`（失败可后续扩展到预加载剪贴板）；
  - `查看详情` → 路由跳转（现有 `router.navigate({ to: "/devices/${d.id}" })`）；
  - `刷新设备` → 调用现有 `refresh()`；
  - （可选）快速设置类型：调用 `window.api.updateDeviceSettings(d.id, { type: 'ignored' | 'recorder' | 'generic' })`；
- 保持现有 `extra` 区域按钮不变，右键菜单作为增量能力。

### 3) 分数显示与提示

- 文件数：将 `Typography.Text` 改为 `Tooltip` 包裹，显示 `${statsMap[d.id]?.syncedCount ?? 0}/${statsMap[d.id]?.fileCount ?? 0}`，`Tooltip` 文案为“已同步/文件总数”。
- 容量：
  - 计算 `used = total - free`；
  - `Progress` 增加 `format={() => `${formatBytes(used)} / ${formatBytes(total)}`}`；
  - 外层再包 `Tooltip`，说明“已用/总容量”。
- 在本组件内新增轻量 `formatBytes` 方法（如 1024 进制到 `MB/GB`），无仓库级通用方法时本地实现。

### 4) 连接设备后的数据更新

- `refresh()` 中在拿到 `connected` 与 `persistedList` 后，进行“容量字段覆盖合并”：
  - 构建 `connectedMap`（`id` → `{ capacityTotal, capacityFree, mountpoint, label }`）；
  - `all = persistedList.map(d => connectedMap[d.id] ? { ...d, ...connectedMap[d.id] } : d)`；
  - 这样即使优先显示“持久化列表”，当设备连接时也能拿到最新容量与挂载点信息。
- 保持 `statsMap` 的刷新逻辑不变（当前已对 `all` 批量获取 `fileCount/syncedCount`）。

### 5) 类型与安全

- 严格更新 `src/preload/index.d.ts` 与渲染端调用类型一致；
- IPC 入参做基本校验与错误处理，失败时返回 `false` 并在渲染层通过 `message.error` 反馈。
- 继续遵守 `contextIsolation: true`、禁止直接使用 `remote`。

## 校验与验证

- 运行 `pnpm qa`：类型检查、Lint、格式化一次性通过；
- 启动预览 `pnpm start`：
  - 右键菜单显示正常；
  - “在资源管理器打开”能打开对应盘符根；
  - 插拔设备触发 `device:changed` 后，文件分数与容量分数更新；
  - 悬浮提示文字正确。

## 可选增强（后续）

- 右键菜单增加“取消同步”“查看最近同步记录”。
- 复制挂载点/容量信息。
- 设备“弹出(Eject)”需要额外主进程能力（安全与权限另行评估）。
